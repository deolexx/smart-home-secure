spring:
  application:
    name: smart-home-hub
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/smarthome}
    username: ${SPRING_DATASOURCE_USERNAME:smarthome}
    password: ${SPRING_DATASOURCE_PASSWORD:smarthome123}
    driver-class-name: ${SPRING_DATASOURCE_DRIVER_CLASS_NAME:org.postgresql.Driver}
  jpa:
    hibernate:
      ddl-auto: update
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    properties:
      hibernate:
        format_sql: true
    show-sql: false
  jackson:
    serialization:
      write-dates-as-timestamps: false
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_ISSUER_URI:http://localhost:8090/realms/smarthome}

server:
  port: 8080

# Keycloak client configuration
keycloak:
  client-id: ${KEYCLOAK_CLIENT_ID:smart-home-hub}
  realm: smarthome
  server-url: ${KEYCLOAK_SERVER_URL:http://localhost:8090}
  admin:
    server-url: ${KEYCLOAK_SERVER_URL:http://localhost:8090}
    realm: ${KEYCLOAK_REALM:smarthome}
    admin-realm: ${KEYCLOAK_ADMIN_REALM:master}
    admin-client-id: ${KEYCLOAK_ADMIN_CLIENT_ID:admin-cli}
    admin-client-secret: ${KEYCLOAK_ADMIN_CLIENT_SECRET:}
    admin-username: ${KEYCLOAK_ADMIN_USERNAME:admin}
    admin-password: ${KEYCLOAK_ADMIN_PASSWORD:admin123!}

mqtt:
  broker-url: ${MQTT_BROKER_URL:tcp://localhost:1883}
  tls-enabled: ${MQTT_TLS_ENABLED:false}
  client-id: hub-gateway
  telemetry-topic-filter: devices/+/telemetry
  command-topic-format: devices/%s/cmd
  # TLS keystore/truststore - provide valid files to enable MQTTS mutual TLS
  keystore-path: ""
  keystore-password: ""
  key-password: ""
  truststore-path: ""
  truststore-password: ""

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,env,configprops,beans,loggers,httptrace,threaddump,heapdump
  endpoint:
    health:
      show-details: always

# OpenAPI / Swagger configuration
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operations-sorter: method
    tags-sorter: alpha
    try-it-out-enabled: true

---
spring:
  config:
    activate:
      on-profile: prod
server:
  port: 8443
  ssl:
    enabled: true
    key-store: file:config/tls/server-keystore.p12
    key-store-password: changeit
    key-store-type: PKCS12
    key-alias: server
